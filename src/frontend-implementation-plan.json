{
  "kind": "implementation_plan",
  "version": "1.0",
  "title": "Update app canonical subdomain and preserve legacy subdomain via client-side redirect",
  "requirements": [
    {
      "id": "REQ-16",
      "summary": "Treat josh.caffeine.xyz as the canonical production URL in the frontend and avoid using josh-ulx.caffeine.xyz as the primary URL.",
      "acceptanceCriteria": [
        "Visiting https://josh.caffeine.xyz loads the app successfully in production.",
        "The production deployment no longer uses the `josh-ulx` subdomain as the primary/canonical app URL."
      ],
      "file_operations": [
        {
          "path": "frontend/src/main.tsx",
          "operation": "modify",
          "description": "Add an early runtime hostname canonicalization check so the app considers josh.caffeine.xyz the canonical host (e.g., by redirecting away from the legacy host before React/Internet Identity initialization)."
        },
        {
          "path": "frontend/index.html",
          "operation": "modify",
          "description": "Update/augment document metadata to reflect the canonical production URL where applicable (e.g., add or update a canonical link element pointing to josh.caffeine.xyz, without changing branding beyond what is required for the subdomain change)."
        }
      ]
    },
    {
      "id": "REQ-17",
      "summary": "Ensure visits to josh-ulx.caffeine.xyz transparently resolve to josh.caffeine.xyz while preserving full path, query, and hash routing so authentication and app flows keep working.",
      "acceptanceCriteria": [
        "Requests to https://josh-ulx.caffeine.xyz/* redirect (or otherwise resolve) to https://josh.caffeine.xyz/* while preserving the route (including hash-based routes).",
        "After redirection, Internet Identity sign-in and authenticated actions (posting/liking/following/replying/reposting) still function as before."
      ],
      "file_operations": [
        {
          "path": "frontend/src/main.tsx",
          "operation": "modify",
          "description": "Implement a client-side redirect from host josh-ulx.caffeine.xyz to josh.caffeine.xyz that preserves window.location.pathname, window.location.search, and window.location.hash; run this before mounting the app so Internet Identity/login flows occur only on the new host."
        },
        {
          "path": "frontend/src/hooks/useInternetIdentity.ts",
          "operation": "modify",
          "description": "Review and adjust any Internet Identity/AuthClient configuration that is origin-sensitive (e.g., derivation origin / identity provider options) to ensure it behaves correctly after the host redirect and does not retain/assume the legacy host in production."
        }
      ]
    }
  ]
}